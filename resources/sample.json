{
    "inputOutputFile": {
      "inputFileFormat": "csv",
      "inputFileDelimiter": ",",
      "inputFileHasHeader": "true"
    },

    "transforms": [

      {
        "ttype": "directMap",
        "rule": "Quantity",
        "dest": "Q1"
      },
      {
        "rule": "rand()",
        "dest": "randCol"
      },
      {
        "ttype": "directMap",
        "rule": "UnitPrice",
        "dest": "UP"
      },
      {
        "ttype": "defaultMap",
        "rule": "USD",
        "dest": "Currency"
      },
      {
        "ttype": "ifElse",
        "rule": "case when Quantity = 6 then 9 else '' end",
        "dest": "Q1to9"
      },
      {
        "ttype": "concat",
        "rule": "(stockCode, '*', Currency, '$')",
        "dest": "CurStock"
      },
      {
        "ttype": "concat",
        "rule": "(stockCode, '_P')",
        "dest": "PstockCode"
      },
      {
        "ttype": "expression",
        "rule": "case when Q1 = 6 then unitPrice else 0 end",
        "dest": "UPQ1"
      },
      {
        "rule": "case when Q1 = 6 then unitPrice else 0 end",
        "dest": "UPQ2"
      },
      {
        "ttype": "split",
        "rule": "(stockCode = '84406B' or stockCode like '84%') and unitPrice != 2.55",
        "dest": "Q1to92Split"
      },
      {
        "ttype": "where",
        "rule": "Q1 == 6"
      },
      {
        "ttype": "drop",
        "rule": "UP == 0"
      }

    ],
    "split": [{
      "name" : "Q1to92Split",
      "dest_row_trans": [
        {
          "rule": "UPQ2 * Q1",
          "dest": "UP"
        },
        {
          "rule": "Q1to9 / 2",
          "dest": "randCol"
        }
      ],
      "source_row_trans": [
        {
          "ttype": "drop",
          "rule": "1 == 1"
        }
      ]
    }],
    "select": "UP, UPQ1 as UPQ3, UPQ2, PstockCode, Q1, Q1to9, Q1to9 as Q1to92, randCol",
    "struct": [
      {
        "name": "invoiceno",
        "datatype": "LongType",
        "nullable": true
      },
      {
        "name": "stockCode",
        "datatype": "StringType",
        "nullable": true
      },
      {
        "name": "description",
        "datatype": "StringType",
        "nullable": true
      },
      {
        "name": "quantity",
        "datatype": "IntegerType",
        "nullable": true
      },
      {
        "name": "invoiceDate",
        "datatype": "DateType",
        "nullable": true
      },
      {
        "name": "unitPrice",
        "datatype": "DoubleType",
        "nullable": true
      },
      {
        "name": "customer_id",
        "datatype": "DoubleType",
        "nullable": true
      },
      {
        "name": "country",
        "datatype": "StringType",
        "nullable": true
      }
    ]
}
